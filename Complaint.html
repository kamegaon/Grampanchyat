<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ग्रामपंचायत – तक्रार प्रणाली</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
body {
  margin: 0;
  font-family: "Noto Sans Devanagari", Arial, sans-serif;
  background: #fdf7f2;
  color: #333;
}
header {
  background: linear-gradient(90deg,#ff9800,#ffb74d);
  color: #fff;
  padding: 20px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  position: sticky;
  top: 0;
  z-index: 1000;
}
main {
  max-width: 900px;
  margin: 20px auto;
  padding: 0 15px;
}
.card {
  background: #fff;
  border-radius: 15px;
  margin-bottom: 25px;
  overflow: hidden;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  transform-style: preserve-3d;
  transition: transform 0.3s, box-shadow 0.3s;
}
.card:hover {
  transform: translateY(-8px) rotateX(2deg) rotateY(2deg);
  box-shadow: 0 12px 25px rgba(0,0,0,0.25);
}
.card-head {
  background: #f57c00;
  color: #fff;
  padding: 18px 22px;
  font-size: 18px;
  font-weight: bold;
  letter-spacing: 1px;
}
.list { display: grid; gap: 18px; padding: 18px; }
.item {
  background: #fff7ef;
  border-radius: 12px;
  padding: 16px;
  border: 1px solid #eee;
  box-shadow: 0 6px 18px rgba(0,0,0,0.1);
  transition: transform 0.3s, box-shadow 0.3s;
}
.item:hover {
  transform: translateY(-4px) rotateX(1deg);
  box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}
.name { font-weight: bold; font-size: 16px; color:#d84315; }
.time { font-size: 12px; color: #666; margin-top: 2px; }
.text { margin-top: 8px; white-space: pre-wrap; font-size: 14px; }
.thumb img {
  margin-top: 10px;
  border-radius: 10px;
  max-width: 100%;
  height: auto;
  display: block;
  border: 1px solid #ccc;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
.empty {
  text-align: center;
  color: #888;
  font-style: italic;
  padding: 30px;
  font-size: 15px;
}
.floating-btn {
  position: fixed;
  bottom: 25px;
  right: 25px;
  background: #f57c00;
  color: #fff;
  padding: 16px 24px;
  border: none;
  border-radius: 50px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.2);
  cursor: pointer;
  font-weight: bold;
  font-size: 16px;
  transition: 0.3s;
  z-index: 1000;
}
.floating-btn:hover { background: #e65100; }
@media (max-width: 600px) {
  header { font-size: 18px; padding: 15px; }
  .card-head { font-size: 16px; padding: 12px; }
  .item { font-size: 14px; padding: 12px; }
  .floating-btn { padding: 12px 20px; font-size: 14px; }
}
</style>
</head>
<body>

<header>ग्रामपंचायत तक्रार प्रणाली</header>

<main>
  <section class="card">
    <div class="card-head">अलीकडील तक्रारी</div>
    <div class="list" id="list"></div>
    <div class="empty" id="emptyMsg">ग्रामपंचायतसाठी कोणतीही तक्रार उपलब्ध नाही.</div>
  </section>
</main>

<button class="floating-btn" onclick="openForm()">➕ तक्रार नोंदवा</button>

<script>
const CSV_LINK = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRlJiG7E-uic4Z-j_hk_Yji3BDCH52HLUCV7Hkpg7QaRDs87mzqDko6xPgFsXgoU_mEyeyESpqpGH8m/pub?output=csv";
const FORM_LINK = "https://docs.google.com/forms/d/e/1FAIpQLSfQ-BZJMRk2poh_ww0BuRISMH8QnyrsD0rf4pM8C8dHfy7rnQ/viewform";

function nameFromEmail(email) {
  if (!email) return "Guest";
  let name = email.split('@')[0].replace(/[._-]+/g, ' ');
  return name.charAt(0).toUpperCase() + name.slice(1);
}

function render(items) {
  const listEl = document.getElementById("list");
  const emptyMsg = document.getElementById("emptyMsg");
  listEl.innerHTML = "";
  if (items.length === 0) {
    emptyMsg.style.display = "block";
  } else {
    emptyMsg.style.display = "none";
    items.forEach(it => {
      const card = document.createElement("div");
      card.className = "item";

      // Use default image if not present
      let imgHTML = it.image ? `<div class="thumb"><img src="${it.image}" alt="Complaint image" onerror="this.src='https://cdn-icons-png.flaticon.com/512/149/149071.png'"></div>` 
                              : `<div class="thumb"><img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="No image"></div>`;

      card.innerHTML = `
        <div class="name">${it.name || "Guest"}</div>
        <div class="time">${it.when || ""}</div>
        <div class="text">${it.text || ""}</div>
        ${imgHTML}
      `;
      listEl.appendChild(card);
    });
  }
}

function openForm() {
  window.open(FORM_LINK, "_blank");
}

function loadCSV() {
  Papa.parse(CSV_LINK, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      const data = results.data.map(r => ({
        name: r["Name"] || nameFromEmail(r["Email Address"]),
        when: r["Timestamp"] || "",
        text: r["Complaint"] || "",
        image: r["Image"] || r["img"] || ""
      }));
      render(data);
    },
    error: function(err) {
      console.error("CSV Load Error:", err);
      document.getElementById("emptyMsg").style.display = "block";
    }
  });
}

loadCSV();
</script>

</body>
</html>
