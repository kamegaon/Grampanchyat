<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Kamegaon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family:'Arial',sans-serif; background:#fdfdfd; margin:0; padding:0; display:flex; flex-direction:column; align-items:center;}
    
    /* üîπ Animated Header */
    h1 { 
      text-align:center; 
      color:#fff; 
      width:100%; 
      padding:20px; 
      border-radius:0 0 25px 25px; 
      animation: headerAnim 6s infinite alternate;
      box-shadow:0 4px 12px rgba(0,0,0,0.2);
    }
    @keyframes headerAnim {
      0% { background:linear-gradient(135deg,#a8edea,#fed6e3); }
      50% { background:linear-gradient(135deg,#cfd9df,#e2ebf0); }
      100% { background:linear-gradient(135deg,#d4fc79,#96e6a1); }
    }

    .container { width:90%; max-width:850px; margin:20px auto; padding:20px; border-radius:20px; background:linear-gradient(145deg,#f9f9ff,#f1faff); box-shadow:6px 6px 15px rgba(0,0,0,0.1), -6px -6px 15px #fff; animation: fadeIn 0.6s ease;}
    input,textarea,button,select { width:100%; padding:12px; margin:10px 0; border-radius:10px; border:none; font-size:16px; background:#ffffff; box-shadow: inset 2px 2px 5px rgba(0,0,0,0.1), inset -2px -2px 5px #fff; transition:all 0.2s ease;}
    input:focus,textarea:focus,select:focus { outline:none; background:#f0f8ff;}
    button { cursor:pointer; font-weight:bold; background:linear-gradient(135deg,#cce7ff,#e6f7ff); color:#222; box-shadow:3px 3px 8px rgba(0,0,0,0.15),-3px -3px 8px #fff; transition:all 0.2s ease;}
    button:hover { transform:translateY(-2px); background:linear-gradient(135deg,#b3e0ff,#d9f0ff);}
    button:active { transform:scale(0.97);}
    .card { background:linear-gradient(145deg,#fff,#fdf6ff); padding:15px; border-radius:15px; margin:10px 0; box-shadow:5px 5px 12px rgba(0,0,0,0.1),-5px -5px 12px #fff; animation: slideUp 0.5s ease;}
    .hidden { display:none;}
    .admin-actions { display:flex; gap:10px; margin-top:8px; }
    .admin-actions button { width:auto; padding:6px 12px; font-size:14px; background:linear-gradient(135deg,#ffe6e6,#fff0f0);}
    label { font-weight:bold; margin-top:10px; display:block;}
    @keyframes fadeIn { from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);} }
    @keyframes slideUp { from{opacity:0; transform:translateY(30px);} to{opacity:1; transform:translateY(0);} }
  </style>
</head>
<body>

  <h1>Admin Dashboard - Kamegaon</h1>

  <!-- Login -->
  <div id="loginDiv" class="container">
    <h2>Login</h2>
    <label>Email</label>
    <input type="email" id="loginEmail" placeholder="‡§Ü‡§™‡§≤‡§æ ‡§à‡§Æ‡•á‡§≤">
    <label>Password</label>
    <input type="password" id="loginPassword" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
    <button id="loginBtn"><i class="fas fa-sign-in-alt"></i> Login</button>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="container hidden">
    <button id="signOutBtn"><i class="fas fa-sign-out-alt"></i> Sign Out</button>

    <!-- Superadmin Section -->
    <div id="superAdminDiv" class="hidden">
      <h2>Admin ‡§Ø‡§æ‡§¶‡•Ä (Superadmin Only)</h2>
      <ul id="adminList"></ul>

      <h3>‡§®‡§µ‡•Ä‡§® Admin ‡§ú‡•ã‡§°‡§æ</h3>
      <label>Email</label>
      <input type="email" id="newAdminEmail" placeholder="Admin ‡§à‡§Æ‡•á‡§≤">
      <label>Role</label>
      <select id="newAdminRole">
        <option value="admin">Admin</option>
        <option value="superadmin">Superadmin</option>
      </select>
      <button id="addAdminBtn">Add Admin</button>
    </div>

    <!-- Add Notice -->
    <div>
      <h2>‡§®‡§µ‡•Ä‡§® ‡§∏‡•Ç‡§ö‡§®‡§æ ‡§ú‡•ã‡§°‡§æ</h2>
      <label>‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï (optional)</label>
      <input id="noticeTitle" placeholder="‡§â‡§¶‡§æ: ‡§™‡§æ‡§£‡•Ä‡§™‡•Å‡§∞‡§µ‡§†‡§æ ‡§∏‡•Ç‡§ö‡§®‡§æ">
      <label>‡§∏‡§Ç‡§¶‡•á‡§∂</label>
      <textarea id="noticeMessage" placeholder="‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡•á‡§•‡•á ‡§ü‡§æ‡§ï‡§æ..."></textarea>
      <button id="saveNoticeBtn">‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§æ</button>
    </div>

    <!-- Notices -->
    <div>
      <h2>‡§∏‡•Ç‡§ö‡§®‡§æ ‡§Ø‡§æ‡§¶‡•Ä</h2>
      <ul id="noticeList"></ul>
    </div>
  </div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBvTQvsSsy4nq-xknFYQmiVcdTOSIQ9T-c",
    authDomain: "panchayatsetu.firebaseapp.com",
    projectId: "panchayatsetu",
    storageBucket: "panchayatsetu.appspot.com",
    messagingSenderId: "1082762014645",
    appId: "1:1082762014645:web:ef3a343c8d75907aba73fc"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const loginDiv=document.getElementById('loginDiv');
  const dashboard=document.getElementById('dashboard');
  const superAdminDiv=document.getElementById('superAdminDiv');
  const adminList=document.getElementById('adminList');

  // Login
  document.getElementById('loginBtn').onclick=async()=>{
    const email=document.getElementById('loginEmail').value;
    const password=document.getElementById('loginPassword').value;
    try{ await auth.signInWithEmailAndPassword(email,password); }
    catch(err){ alert(err.message);}
  };

  // Auth state
  auth.onAuthStateChanged(async user=>{
    if(user){
      loginDiv.classList.add('hidden');
      dashboard.classList.remove('hidden');
      const adminDoc=await db.collection('admins').doc(user.email).get();
      if(!adminDoc.exists){ alert('‡§Ü‡§™‡§£ ‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§ï ‡§®‡§æ‡§π‡•Ä.'); auth.signOut(); return; }
      const role=adminDoc.data().role;
      if(role==='superadmin'){ superAdminDiv.classList.remove('hidden'); loadAdmins(); }
      loadNotices();
    } else {
      loginDiv.classList.remove('hidden');
      dashboard.classList.add('hidden');
    }
  });

  document.getElementById('signOutBtn').onclick=()=>auth.signOut();

  // Add Admin
  document.getElementById('addAdminBtn').onclick=async()=>{
    const email=document.getElementById('newAdminEmail').value;
    const role=document.getElementById('newAdminRole').value;
    const currentUser=auth.currentUser.email;
    if(!email){alert('‡§à‡§Æ‡•á‡§≤ ‡§≠‡§∞‡§æ');return;}
    await db.collection('admins').doc(email).set({role,createdBy:currentUser});
    alert('Admin added!');
    loadAdmins();
  };

  // Load Admins (Superadmin only)
  async function loadAdmins(){
    adminList.innerHTML='';
    const snap=await db.collection('admins').get();
    snap.forEach(doc=>{
      const data=doc.data();
      const li=document.createElement('li');
      li.className='card';
      li.innerHTML=`<strong>${doc.id}</strong> - Role: ${data.role}
        <div class="admin-actions">
          <button onclick="editAdmin('${doc.id}','${data.role}')">Edit Role</button>
          <button onclick="deleteAdmin('${doc.id}')">Delete</button>
          <button onclick="resetPassword('${doc.id}')">Reset Password</button>
        </div>`;
      adminList.appendChild(li);
    });
  }

  // Edit role
  window.editAdmin=async(email,currentRole)=>{
    const newRole=prompt('‡§®‡§µ‡•Ä‡§® Role ‡§¶‡•ç‡§Ø‡§æ (admin/superadmin):',currentRole);
    if(newRole){ await db.collection('admins').doc(email).update({role:newRole}); loadAdmins();}
  };

  // Delete admin
  window.deleteAdmin=async(email)=>{
    if(confirm('Delete this admin?')){ await db.collection('admins').doc(email).delete(); loadAdmins();}
  };

  // Reset Password
  window.resetPassword=async(email)=>{
    try{
      await auth.sendPasswordResetEmail(email);
      alert('Password reset email sent to '+email);
    }catch(e){ alert(e.message);}
  };

  // Notices
  document.getElementById('saveNoticeBtn').onclick=async()=>{
    const title=document.getElementById('noticeTitle').value;
    const message=document.getElementById('noticeMessage').value;
    if(!message.trim()){ alert('‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§∞‡§ø‡§ï‡•ç‡§§ ‡§∞‡§æ‡§π‡•Ç ‡§∂‡§ï‡§§ ‡§®‡§æ‡§π‡•Ä'); return;}
    await db.collection('notifications').add({title,message,createdAt:firebase.firestore.FieldValue.serverTimestamp()});
    document.getElementById('noticeTitle').value='';
    document.getElementById('noticeMessage').value='';
    loadNotices();
  };

  async function loadNotices(){
    const ul=document.getElementById('noticeList');
    ul.innerHTML='';
    const snap=await db.collection('notifications').orderBy('createdAt','desc').get();
    snap.forEach(doc=>{
      const data=doc.data();
      const li=document.createElement('li');
      li.className='card';
      li.innerHTML=`<strong>${data.title||''}</strong><br>${data.message}`;
      ul.appendChild(li);
    });
  }
</script>
</body>
</html>
