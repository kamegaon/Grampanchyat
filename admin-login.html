<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Kamegaon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    body { font-family: 'Arial', sans-serif; margin:0; background:#f7f9fc; color:#333; }
    header { background:#dceefc; color:#222; padding:15px; text-align:center; font-size:22px;
             box-shadow:0 4px 8px rgba(0,0,0,0.1); position:sticky; top:0; z-index:100; }
    h2 { color:#444; margin-top:20px; }

    .container { width:90%; max-width:900px; margin:20px auto; padding:15px; }
    .hidden { display:none; }

    input, textarea, select { width:100%; padding:10px; margin:8px 0; border-radius:8px; border:1px solid #ccc;
      font-size:15px; box-shadow:inset 2px 2px 5px #e0e0e0, inset -2px -2px 5px #fff; }

    button { background:#f0f0f0; border:none; border-radius:10px; padding:10px 20px; margin:5px 0;
      font-size:16px; cursor:pointer; box-shadow:3px 3px 8px rgba(0,0,0,0.2), -3px -3px 8px #fff;
      transition:all 0.2s ease; }
    button:hover { transform:translateY(-2px); box-shadow:5px 5px 10px rgba(0,0,0,0.2), -5px -5px 10px #fff; }

    .card { background:#fff; border-radius:12px; padding:15px; margin:10px 0;
      box-shadow:4px 4px 12px rgba(0,0,0,0.1), -4px -4px 12px #fff; transition:transform 0.2s ease; }
    .card:hover { transform:translateY(-3px); }

    .admin-actions button { padding:6px 12px; font-size:14px; margin-right:8px; }

    .notice-meta { font-size:12px; color:#666; margin-top:6px; }
  </style>
</head>
<body>

<header>üå∏ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ - Admin Dashboard</header>

<!-- Login -->
<div id="loginDiv" class="container">
  <h2>Login</h2>
  <label>Email</label>
  <input type="email" id="loginEmail" placeholder="‡§Ü‡§™‡§≤‡§æ ‡§à‡§Æ‡•á‡§≤">
  <label>Password</label>
  <input type="password" id="loginPassword" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
  <button id="loginBtn"><i class="fas fa-sign-in-alt"></i> Login</button>
</div>

<!-- Dashboard -->
<div id="dashboard" class="container hidden">
  <button id="signOutBtn"><i class="fas fa-sign-out-alt"></i> Sign Out</button>

  <!-- Superadmin Panel -->
  <div id="superAdminPanel" class="hidden">
    <h2>üëë Superadmin Controls</h2>

    <!-- Add Admin -->
    <div class="card">
      <h3>‡§®‡§µ‡•Ä‡§® Admin ‡§ú‡•ã‡§°‡§æ</h3>
      <label>Email</label>
      <input type="email" id="newAdminEmail" placeholder="Admin ‡§à‡§Æ‡•á‡§≤">
      <button id="addAdminBtn">Add Admin</button>
    </div>

    <!-- Admin List -->
    <div class="card">
      <h3>Admin ‡§Ø‡§æ‡§¶‡•Ä</h3>
      <ul id="adminList"></ul>
    </div>
  </div>

  <!-- Notices -->
  <div class="card">
    <h2>‡§®‡§µ‡•Ä‡§® ‡§∏‡•Ç‡§ö‡§®‡§æ ‡§ú‡•ã‡§°‡§æ</h2>
    <label>‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï (optional)</label>
    <input id="noticeTitle" placeholder="‡§â‡§¶‡§æ: ‡§™‡§æ‡§£‡•Ä‡§™‡•Å‡§∞‡§µ‡§†‡§æ ‡§∏‡•Ç‡§ö‡§®‡§æ">
    <label>‡§∏‡§Ç‡§¶‡•á‡§∂</label>
    <textarea id="noticeMessage" placeholder="‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡•á‡§•‡•á ‡§ü‡§æ‡§ï‡§æ..."></textarea>
    <button id="saveNoticeBtn">‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§æ</button>
  </div>

  <div class="card">
    <h2>‡§∏‡•Ç‡§ö‡§®‡§æ ‡§Ø‡§æ‡§¶‡•Ä</h2>
    <ul id="noticeList"></ul>
  </div>
</div>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyBvTQvsSsy4nq-xknFYQmiVcdTOSIQ9T-c",
    authDomain: "panchayatsetu.firebaseapp.com",
    projectId: "panchayatsetu",
    storageBucket: "panchayatsetu.firebasestorage.app",
    messagingSenderId: "1082762014645",
    appId: "1:1082762014645:web:ef3a343c8d75907aba73fc"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const loginDiv = document.getElementById('loginDiv');
  const dashboard = document.getElementById('dashboard');
  const superAdminPanel = document.getElementById('superAdminPanel');

  // Login
  document.getElementById('loginBtn').onclick = async () => {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    try {
      await auth.signInWithEmailAndPassword(email,password);
    } catch(err) { alert(err.message); }
  };

  // Auth check
  auth.onAuthStateChanged(async user=>{
    if(user){
      loginDiv.classList.add('hidden');
      dashboard.classList.remove('hidden');

      const adminDoc = await db.collection('admins').doc(user.email).get();
      if(!adminDoc.exists){
        alert('‡§Ü‡§™‡§£ ‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§ï ‡§®‡§æ‡§π‡•Ä.');
        auth.signOut(); return;
      }
      const role = adminDoc.data().role;
      if(role==='superadmin'){
        superAdminPanel.classList.remove('hidden');
        loadAdmins();
      } else {
        superAdminPanel.classList.add('hidden');
      }
      loadNotices(role,user.email);
    } else {
      loginDiv.classList.remove('hidden');
      dashboard.classList.add('hidden');
    }
  });

  document.getElementById('signOutBtn').onclick = ()=>auth.signOut();

  // Add Admin (superadmin only)
  document.getElementById('addAdminBtn').onclick = async ()=>{
    const email=document.getElementById('newAdminEmail').value;
    const currentUser=auth.currentUser.email;
    if(!email) return alert('‡§à‡§Æ‡•á‡§≤ ‡§≠‡§∞‡§æ');
    await db.collection('admins').doc(email).set({role:'admin', createdBy:currentUser});
    alert('Admin added!');
    document.getElementById('newAdminEmail').value='';
    loadAdmins();
  };

  // Load Admins
  async function loadAdmins(){
    const ul=document.getElementById('adminList');
    ul.innerHTML='';
    const snapshot=await db.collection('admins').get();
    snapshot.forEach(doc=>{
      const data=doc.data();
      const li=document.createElement('li');
      li.className='card';
      li.innerHTML=`${doc.id} - Role: ${data.role} (By ${data.createdBy})
        <div class="admin-actions">
          <button onclick="deleteAdmin('${doc.id}')">Delete</button>
          <button onclick="resetPassword('${doc.id}')">Reset Password</button>
        </div>`;
      ul.appendChild(li);
    });
  }
  async function deleteAdmin(email){
    if(confirm('Delete admin?')){
      await db.collection('admins').doc(email).delete();
      loadAdmins();
    }
  }
  async function resetPassword(email){
    await auth.sendPasswordResetEmail(email);
    alert('Password reset link sent to '+email);
  }

  // Add Notice
  document.getElementById('saveNoticeBtn').onclick = async ()=>{
    const title=document.getElementById('noticeTitle').value;
    const message=document.getElementById('noticeMessage').value;
    if(!message.trim()) return alert('‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§∞‡§ø‡§ï‡•ç‡§§ ‡§∞‡§æ‡§π‡•Ç ‡§∂‡§ï‡§§ ‡§®‡§æ‡§π‡•Ä');
    await db.collection('notifications').add({
      title,message,
      createdAt:firebase.firestore.FieldValue.serverTimestamp(),
      createdBy:auth.currentUser.email
    });
    document.getElementById('noticeTitle').value='';
    document.getElementById('noticeMessage').value='';
    loadNotices();
  };

  // Load Notices
  async function loadNotices(role,email){
    const ul=document.getElementById('noticeList');
    ul.innerHTML='';
    const snapshot=await db.collection('notifications').orderBy('createdAt','desc').get();
    snapshot.forEach(doc=>{
      const data=doc.data();
      const li=document.createElement('li');
      li.className='card';
      li.innerHTML=`<strong>${data.title||''}</strong><br>${data.message}
        <div class="notice-meta">By: ${data.createdBy||'Unknown'}</div>`;
      // Edit/Delete
      if(role==='superadmin' || data.createdBy===email){
        const actions=document.createElement('div');
        actions.className='admin-actions';
        const editBtn=document.createElement('button');
        editBtn.textContent='Edit';
        editBtn.onclick=async ()=>{
          const newMsg=prompt('Edit message:',data.message);
          if(newMsg!==null){
            await db.collection('notifications').doc(doc.id).update({message:newMsg});
            loadNotices(role,email);
          }
        };
        const delBtn=document.createElement('button');
        delBtn.textContent='Delete';
        delBtn.onclick=async ()=>{
          if(confirm('Delete notice?')){
            await db.collection('notifications').doc(doc.id).delete();
            loadNotices(role,email);
          }
        };
        actions.appendChild(editBtn);
        actions.appendChild(delBtn);
        li.appendChild(actions);
      }
      ul.appendChild(li);
    });
  }
</script>
</body>
</html>
