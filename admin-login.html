<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Kamegaon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
  <style>
  body { 
    font-family: 'Arial', sans-serif; 
    background:#fdfdfd; /* soft background */
    margin:0; padding:0; 
    display:flex; flex-direction:column; align-items:center;
  }
  h1,h2 { text-align:center; color:#333; }

  /* Containers with pastel gradient */
  .container { 
    width:90%; max-width:800px; margin:20px auto; 
    padding:20px; border-radius:20px;
    background:linear-gradient(145deg,#f9f9ff,#f1faff);
    box-shadow: 6px 6px 15px rgba(0,0,0,0.1), -6px -6px 15px #fff;
    animation: fadeIn 0.6s ease;
  }

  input,textarea,button,select { 
    width:100%; padding:12px; margin:10px 0; 
    border-radius:10px; border:none; font-size:16px; 
    background:#ffffff; 
    box-shadow: inset 2px 2px 5px rgba(0,0,0,0.1), inset -2px -2px 5px #fff;
    transition: all 0.2s ease;
  }
  input:focus,textarea:focus,select:focus {
    outline:none;
    background:#f0f8ff;
  }

  /* Buttons with soft pastel colors */
  button { 
    cursor:pointer; font-weight:bold;
    background:linear-gradient(135deg,#cce7ff,#e6f7ff);
    color:#222;
    box-shadow: 3px 3px 8px rgba(0,0,0,0.15), -3px -3px 8px #fff;
    transition: all 0.2s ease;
  }
  button:hover { 
    transform:translateY(-2px); 
    background:linear-gradient(135deg,#b3e0ff,#d9f0ff);
  }
  button:active { transform:scale(0.97); }

  /* Notice cards */
  .card { 
    background:linear-gradient(145deg,#fff,#fdf6ff); 
    padding:15px; border-radius:15px; margin:10px 0; 
    box-shadow: 5px 5px 12px rgba(0,0,0,0.1), -5px -5px 12px #fff;
    animation: slideUp 0.5s ease;
  }

  .hidden { display:none;}
  .admin-actions { display:flex; gap:10px; margin-top:8px; }
  .admin-actions button { 
    width:auto; padding:6px 12px; font-size:14px; 
    background:linear-gradient(135deg,#ffe6e6,#fff0f0);
  }

  label { font-weight:bold; margin-top:10px; display:block; }

  /* Profile Bar */
  .profile-bar {
    display:flex; justify-content:space-between; align-items:center;
    padding:12px 20px; margin-bottom:15px;
    background:linear-gradient(135deg,#fff0f5,#f9f9ff);
    border-radius:12px;
    box-shadow: 4px 4px 10px rgba(0,0,0,0.15), -4px -4px 10px #fff;
    animation: fadeIn 0.6s ease;
  }
  .profile-bar span { font-weight:bold; color:#444; }
  .profile-bar button { 
    width:auto; padding:8px 15px; 
    background:linear-gradient(135deg,#ffd9b3,#fff2e6);
  }

  /* Show password toggle */
  .password-container { position:relative; }
  .password-container i {
    position:absolute; top:35%; right:12px; cursor:pointer; color:#666;
  }

  /* Animations */
  @keyframes fadeIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
  @keyframes slideUp { from {opacity:0; transform:translateY(30px);} to {opacity:1; transform:translateY(0);} }
</style>

  </style>
</head>
<body>

  <h1>Admin Dashboard - Kamegaon</h1>

  <!-- Login Form -->
  <div id="loginDiv" class="container">
    <h2>Login</h2>
    <label>Email</label>
    <input type="email" id="loginEmail" placeholder="‡§Ü‡§™‡§≤‡§æ ‡§à‡§Æ‡•á‡§≤">
    <label>Password</label>
    <div class="password-container">
      <input type="password" id="loginPassword" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
      <i id="togglePass" class="fas fa-eye"></i>
    </div>
    <button id="loginBtn"><i class="fas fa-sign-in-alt"></i> Login</button>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="container hidden">
    <div class="profile-bar">
      <span id="profileInfo">üë§</span>
      <button id="signOutBtn"><i class="fas fa-sign-out-alt"></i> Sign Out</button>
    </div>

    <!-- Superadmin: Add Admin -->
    <div id="addAdminDiv" class="hidden">
      <h2>‡§®‡§µ‡•Ä‡§® Admin ‡§ú‡•ã‡§°‡§æ</h2>
      <label>Email</label>
      <input type="email" id="newAdminEmail" placeholder="Admin ‡§à‡§Æ‡•á‡§≤">
      <label>Role</label>
      <select id="newAdminRole">
        <option value="admin">Admin</option>
        <option value="superadmin">Superadmin</option>
      </select>
      <button id="addAdminBtn"><i class="fas fa-user-plus"></i> Add Admin</button>
    </div>

    <!-- Add Notice -->
    <div>
      <h2>‡§®‡§µ‡•Ä‡§® ‡§∏‡•Ç‡§ö‡§®‡§æ ‡§ú‡•ã‡§°‡§æ</h2>
      <label>‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï (optional)</label>
      <input id="noticeTitle" placeholder="‡§â‡§¶‡§æ: ‡§™‡§æ‡§£‡•Ä‡§™‡•Å‡§∞‡§µ‡§†‡§æ ‡§∏‡•Ç‡§ö‡§®‡§æ">
      <label>‡§∏‡§Ç‡§¶‡•á‡§∂</label>
      <textarea id="noticeMessage" placeholder="‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡•á‡§•‡•á ‡§ü‡§æ‡§ï‡§æ..."></textarea>
      <button id="saveNoticeBtn"><i class="fas fa-save"></i> ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§æ</button>
    </div>

    <!-- Notice List -->
    <div>
      <h2>‡§∏‡•Ç‡§ö‡§®‡§æ ‡§Ø‡§æ‡§¶‡•Ä</h2>
      <ul id="noticeList"></ul>
    </div>
  </div>

<script>
  // Firebase config
 const firebaseConfig = {
  apiKey: "AIzaSyBvTQvsSsy4nq-xknFYQmiVcdTOSIQ9T-c",
  authDomain: "panchayatsetu.firebaseapp.com",
  projectId: "panchayatsetu",
  storageBucket: "panchayatsetu.firebasestorage.app",
  messagingSenderId: "1082762014645",
  appId: "1:1082762014645:web:ef3a343c8d75907aba73fc"
};
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Toggle Password
  document.getElementById('togglePass').onclick = () => {
    const passInput = document.getElementById('loginPassword');
    const icon = document.getElementById('togglePass');
    if(passInput.type === "password"){
      passInput.type = "text"; icon.classList.replace("fa-eye","fa-eye-slash");
    } else {
      passInput.type = "password"; icon.classList.replace("fa-eye-slash","fa-eye");
    }
  };

  // Login
  document.getElementById('loginBtn').onclick = async () => {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    try {
      await auth.signInWithEmailAndPassword(email,password);
    } catch(err) { alert(err.message); }
  };

  // Auth state
  auth.onAuthStateChanged(async user=>{
    if(user){
      loginDiv.classList.add('hidden');
      dashboard.classList.remove('hidden');
      document.getElementById('profileInfo').innerText = "üë§ "+user.email;

      const adminDoc = await db.collection('admins').doc(user.email).get();
      if(!adminDoc.exists){
        alert('‡§Ü‡§™‡§£ ‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§ï ‡§®‡§æ‡§π‡•Ä.');
        auth.signOut();
        return;
      }
      const role = adminDoc.data().role;
      if(role==='superadmin') addAdminDiv.classList.remove('hidden');

      loadNotices();
    } else {
      loginDiv.classList.remove('hidden');
      dashboard.classList.add('hidden');
    }
  });

  // Sign Out
  document.getElementById('signOutBtn').onclick = ()=>auth.signOut();

  // Add Admin (Superadmin only)
  document.getElementById('addAdminBtn').onclick = async ()=>{
    const email = document.getElementById('newAdminEmail').value;
    const role = document.getElementById('newAdminRole').value;
    const currentUser = auth.currentUser.email;
    if(!email){ alert('‡§à‡§Æ‡•á‡§≤ ‡§≠‡§∞‡§æ'); return; }
    await db.collection('admins').doc(email).set({role, createdBy: currentUser});
    alert('Admin added!');
    document.getElementById('newAdminEmail').value='';
  };

  // Add Notice
  document.getElementById('saveNoticeBtn').onclick = async ()=>{
    const title = document.getElementById('noticeTitle').value;
    const message = document.getElementById('noticeMessage').value;
    if(!message.trim()){ alert('‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§∞‡§ø‡§ï‡•ç‡§§ ‡§∞‡§æ‡§π‡•Ç ‡§∂‡§ï‡§§ ‡§®‡§æ‡§π‡•Ä'); return; }
    await db.collection('notifications').add({
      title, message, createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    document.getElementById('noticeTitle').value='';
    document.getElementById('noticeMessage').value='';
    loadNotices();
  };

  // Load Notices
  async function loadNotices(){
    const ul = document.getElementById('noticeList');
    ul.innerHTML='';
    const snapshot = await db.collection('notifications').orderBy('createdAt','desc').get();
    snapshot.forEach(doc=>{
      const data = doc.data();
      const li = document.createElement('li');
      li.className='card';
      li.innerHTML=`<strong>${data.title||''}</strong><br>${data.message}<div class="admin-actions"></div>`;
      const actions = li.querySelector('.admin-actions');
      const editBtn = document.createElement('button');
      editBtn.innerHTML='<i class="fas fa-edit"></i> Edit';
      editBtn.onclick = async ()=>{
        const newMessage = prompt('Edit message:', data.message);
        if(newMessage!==null){
          await db.collection('notifications').doc(doc.id).update({message:newMessage});
          loadNotices();
        }
      };
      const delBtn = document.createElement('button');
      delBtn.innerHTML='<i class="fas fa-trash"></i> Delete';
      delBtn.onclick = async ()=>{
        if(confirm('Are you sure?')) {
          await db.collection('notifications').doc(doc.id).delete();
          loadNotices();
        }
      };
      actions.appendChild(editBtn);
      actions.appendChild(delBtn);
      ul.appendChild(li);
    });
  }
</script>
</body>
</html>

