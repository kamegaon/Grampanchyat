<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Kamegaon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f3f3f3;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    h1, h2 { color: #333; }
    button {
      background-color: #e0e0e0;
      border-radius: 8px;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
      font-size: 16px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
      transition: 0.2s;
    }
    button:hover { transform: translateY(-2px); box-shadow: 4px 4px 8px rgba(0,0,0,0.3); }
    input, textarea {
      width: 90%; max-width: 400px;
      padding: 10px; margin: 5px 0;
      border-radius: 6px; border: none;
      box-shadow: inset 2px 2px 5px rgba(0,0,0,0.1);
      font-size: 14px;
    }
    .dashboard { max-width: 800px; margin: 20px auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
    .card { background:#f9f9f9; padding:15px; margin:10px 0; border-radius:10px; box-shadow:2px 2px 5px rgba(0,0,0,0.1); position:relative; }
    .card button { position:absolute; top:10px; right:10px; font-size:12px; padding:5px 10px; }
    #loginBtn { background:#4285F4; color:#fff; }
  </style>
</head>
<body>

  <h1>Admin Dashboard - Kamegaon</h1>
  <button id="loginBtn"><i class="fab fa-google"></i> Sign In with Google</button>
  <button id="signOutBtn" style="display:none;"><i class="fas fa-sign-out-alt"></i> Sign Out</button>

  <div class="dashboard" id="dashboard" style="display:none;">
    <h2>‡§®‡§µ‡•Ä‡§® ‡§∏‡•Ç‡§ö‡§®‡§æ ‡§ú‡•ã‡§°‡§æ</h2>
    <input type="text" id="title" placeholder="‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï (optional)">
    <textarea id="message" placeholder="‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡•á‡§•‡•á ‡§ü‡§æ‡§ï‡§æ..."></textarea>
    <button id="saveNotice">‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§æ</button>

    <h2>‡§∏‡•Ç‡§ö‡§®‡§æ ‡§Ø‡§æ‡§¶‡•Ä</h2>
    <div id="noticeList"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

  <script>
    // üîπ Your Firebase Config
    const firebaseConfig = {
  apiKey: "AIzaSyBvTQvsSsy4nq-xknFYQmiVcdTOSIQ9T-c",
  authDomain: "panchayatsetu.firebaseapp.com",
  projectId: "panchayatsetu",
  storageBucket: "panchayatsetu.firebasestorage.app",
  messagingSenderId: "1082762014645",
  appId: "1:1082762014645:web:ef3a343c8d75907aba73fc"
};
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginBtn = document.getElementById('loginBtn');
    const signOutBtn = document.getElementById('signOutBtn');
    const dashboard = document.getElementById('dashboard');

    // Google Sign-In
    loginBtn.onclick = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider);
    }

    // Sign out
    signOutBtn.onclick = () => auth.signOut();

    auth.onAuthStateChanged(async user => {
      if(user){
        loginBtn.style.display = 'none';
        signOutBtn.style.display = 'inline-block';

        // Check admin role
        const adminDoc = await db.collection('admins').doc(user.email).get();
        if(!adminDoc.exists){
          alert('‡§Ü‡§™‡§£ ‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§ï ‡§®‡§æ‡§π‡•Ä.');
          auth.signOut();
          return;
        }
        dashboard.style.display = 'block';
        loadNotices();
      } else {
        loginBtn.style.display = 'inline-block';
        signOutBtn.style.display = 'none';
        dashboard.style.display = 'none';
      }
    });

    // Save Notice
    document.getElementById('saveNotice').onclick = async () => {
      const title = document.getElementById('title').value.trim();
      const message = document.getElementById('message').value.trim();
      if(!message){ alert('‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§∞‡§ø‡§ï‡•ç‡§§ ‡§∞‡§æ‡§π‡•Ç ‡§∂‡§ï‡§§ ‡§®‡§æ‡§π‡•Ä'); return; }

      await db.collection('notifications').add({
        title, message,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      document.getElementById('title').value='';
      document.getElementById('message').value='';
      loadNotices();
    };

    // Load Notices
    async function loadNotices(){
      const noticeList = document.getElementById('noticeList');
      noticeList.innerHTML = '';
      const snapshot = await db.collection('notifications').orderBy('createdAt','desc').get();
      snapshot.forEach(doc => {
        const data = doc.data();
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<strong>${data.title || ''}</strong><p>${data.message}</p>`;

        // Delete button
        const delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.onclick = async () => {
          await db.collection('notifications').doc(doc.id).delete();
          loadNotices();
        }
        card.appendChild(delBtn);
        noticeList.appendChild(card);
      });
    }
  </script>
</body>
</html>
