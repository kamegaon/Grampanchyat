<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Kamegaon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Arial', sans-serif; background:#f2f2f2; margin:0; padding:0; display:flex; flex-direction:column; align-items:center;}
    h1,h2 { text-align:center; color:#222;}
    .container { width:90%; max-width:800px; margin:20px auto; }
    input,textarea,button { width:100%; padding:10px; margin:8px 0; border-radius:8px; border:none; font-size:16px; }
    button { cursor:pointer; transition:0.2s; background:#e0e0e0; box-shadow:3px 3px 8px rgba(0,0,0,0.2),-3px -3px 8px rgba(255,255,255,0.7);}
    button:hover { transform:translateY(-2px); box-shadow:5px 5px 10px rgba(0,0,0,0.2),-5px -5px 10px rgba(255,255,255,0.7);}
    .card { background:#fff; padding:15px; border-radius:12px; margin:10px 0; box-shadow:4px 4px 12px rgba(0,0,0,0.1),-4px -4px 12px rgba(255,255,255,0.6);}
    .hidden { display:none;}
    .admin-actions { display:flex; gap:10px; margin-top:5px; }
    .admin-actions button { width:auto; padding:6px 12px; font-size:14px;}
    label { font-weight:bold; margin-top:10px; display:block;}
  </style>
</head>
<body>

  <h1>Admin Dashboard - Kamegaon</h1>

  <!-- Login Form -->
  <div id="loginDiv" class="container">
    <h2>Login</h2>
    <label>Email</label>
    <input type="email" id="loginEmail" placeholder="आपला ईमेल">
    <label>Password</label>
    <input type="password" id="loginPassword" placeholder="पासवर्ड">
    <button id="loginBtn"><i class="fas fa-sign-in-alt"></i> Login</button>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="container hidden">
    <button id="signOutBtn"><i class="fas fa-sign-out-alt"></i> Sign Out</button>

    <!-- Superadmin: Add Admin -->
    <div id="addAdminDiv" class="hidden">
      <h2>नवीन Admin जोडा</h2>
      <label>Email</label>
      <input type="email" id="newAdminEmail" placeholder="Admin ईमेल">
      <label>Role</label>
      <select id="newAdminRole">
        <option value="admin">Admin</option>
        <option value="superadmin">Superadmin</option>
      </select>
      <button id="addAdminBtn">Add Admin</button>
    </div>

    <!-- Add Notice -->
    <div>
      <h2>नवीन सूचना जोडा</h2>
      <label>शीर्षक (optional)</label>
      <input id="noticeTitle" placeholder="उदा: पाणीपुरवठा सूचना">
      <label>संदेश</label>
      <textarea id="noticeMessage" placeholder="संदेश येथे टाका..."></textarea>
      <button id="saveNoticeBtn">सुरक्षित करा</button>
    </div>

    <!-- Notice List -->
    <div>
      <h2>सूचना यादी</h2>
      <ul id="noticeList"></ul>
    </div>
  </div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Elements
  const loginDiv = document.getElementById('loginDiv');
  const dashboard = document.getElementById('dashboard');
  const addAdminDiv = document.getElementById('addAdminDiv');

  // Login
  document.getElementById('loginBtn').onclick = async () => {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    try {
      await auth.signInWithEmailAndPassword(email,password);
    } catch(err) { alert(err.message); }
  };

  // Auth state
  auth.onAuthStateChanged(async user=>{
    if(user){
      loginDiv.classList.add('hidden');
      dashboard.classList.remove('hidden');

      const adminDoc = await db.collection('admins').doc(user.email).get();
      if(!adminDoc.exists){
        alert('आपण अधिकृत प्रशासक नाही.');
        auth.signOut();
        return;
      }
      const role = adminDoc.data().role;
      if(role==='superadmin') addAdminDiv.classList.remove('hidden');

      loadNotices();
    } else {
      loginDiv.classList.remove('hidden');
      dashboard.classList.add('hidden');
    }
  });

  // Sign Out
  document.getElementById('signOutBtn').onclick = ()=>auth.signOut();

  // Add Admin (Superadmin only)
  document.getElementById('addAdminBtn').onclick = async ()=>{
    const email = document.getElementById('newAdminEmail').value;
    const role = document.getElementById('newAdminRole').value;
    const currentUser = auth.currentUser.email;
    if(!email){ alert('ईमेल भरा'); return; }
    await db.collection('admins').doc(email).set({role, createdBy: currentUser});
    alert('Admin added!');
    document.getElementById('newAdminEmail').value='';
  };

  // Add Notice
  document.getElementById('saveNoticeBtn').onclick = async ()=>{
    const title = document.getElementById('noticeTitle').value;
    const message = document.getElementById('noticeMessage').value;
    if(!message.trim()){ alert('संदेश रिक्त राहू शकत नाही'); return; }
    await db.collection('notifications').add({
      title, message, createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    document.getElementById('noticeTitle').value='';
    document.getElementById('noticeMessage').value='';
    loadNotices();
  };

  // Load Notices
  async function loadNotices(){
    const ul = document.getElementById('noticeList');
    ul.innerHTML='';
    const snapshot = await db.collection('notifications').orderBy('createdAt','desc').get();
    snapshot.forEach(doc=>{
      const data = doc.data();
      const li = document.createElement('li');
      li.className='card';
      li.innerHTML=`<strong>${data.title||''}</strong><br>${data.message}<div class="admin-actions"></div>`;
      // Edit/Delete
      const actions = li.querySelector('.admin-actions');
      const editBtn = document.createElement('button');
      editBtn.textContent='Edit';
      editBtn.onclick = async ()=>{
        const newMessage = prompt('Edit message:', data.message);
        if(newMessage!==null){
          await db.collection('notifications').doc(doc.id).update({message:newMessage});
          loadNotices();
        }
      };
      const delBtn = document.createElement('button');
      delBtn.textContent='Delete';
      delBtn.onclick = async ()=>{
        if(confirm('Are you sure?')) {
          await db.collection('notifications').doc(doc.id).delete();
          loadNotices();
        }
      };
      actions.appendChild(editBtn);
      actions.appendChild(delBtn);
      ul.appendChild(li);
    });
  }
</script>
</body>
</html>
